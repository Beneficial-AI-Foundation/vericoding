vc-preamble: |-
  function Sum(a: seq<int>, s: int, t: int): int
    requires 0 <= s <= t <= |a|
  {
    if s == t then 0 else Sum(a, s, t-1) + a[t-1]
  }

vc-helpers: |-
  function SubArraySum(nums: seq<int>, s: int, t: int): int
    requires 0 <= s <= t <= |nums|
  {
    if s == t then 0 else SubArraySum(nums, s, t-1) + nums[t-1]
  }
  
  lemma SubArraySumProperties(nums: seq<int>, s: int, t: int)
    requires 0 <= s <= t <= |nums|
    ensures SubArraySum(nums, s, t) == Sum(nums, s, t)
  {
    if s == t {
      assert SubArraySum(nums, s, t) == 0;
      assert Sum(nums, s, t) == 0;
    } else {
      SubArraySumProperties(nums, s, t-1);
      assert SubArraySum(nums, s, t) == SubArraySum(nums, s, t-1) + nums[t-1];
      assert Sum(nums, s, t) == Sum(nums, s, t-1) + nums[t-1];
    }
  }

vc-description: |-
  function_signature: def minSubArraySum(nums : list[int]) -> int
  Given an array of integers nums, find the minimum sum of any non-empty sub-array of nums.

vc-spec: |-
  method minSubArraySum(nums: seq<int>) returns (minSum: int)
    requires |nums| > 0
    ensures exists i, j :: 0 <= i < j <= |nums| && minSum == Sum(nums, i, j)
    ensures forall i, j :: 0 <= i < j <= |nums| ==> minSum <= Sum(nums, i, j)

vc-code: |-
  {
    var n := |nums|;
    minSum := Sum(nums, 0, 1);
    var i := 0;
    while i < n
      invariant 0 <= i <= n
      invariant exists p, q :: 0 <= p < q <= i + 1 && q <= n && minSum == Sum(nums, p, q)
      invariant forall p, q :: 0 <= p < q <= i + 1 && q <= n ==> minSum <= Sum(nums, p, q)
    {
      var j := i + 1;
      while j <= n
        invariant i < j <= n + 1
        invariant 0 <= i < n + 1
        invariant exists p, q :: 0 <= p < q <= j && q <= n && minSum == Sum(nums, p, q)
        invariant forall p, q :: 0 <= p < q <= j && q <= n ==> minSum <= Sum(nums, p, q)
      {
        if j <= n {
          var currentSum := Sum(nums, i, j);
          if currentSum < minSum {
            minSum := currentSum;
          }
        }
        j := j + 1;
      }
      i := i + 1;
    }
  }

vc-postamble: |-


