vc-preamble: |-
  function sum(s: seq<int>) : int {
      if |s| == 0 then 0 else s[0] + sum(s[1..])
  }
  function prod(s: seq<int>) : int {
      if |s| == 0 then 1 else s[0] * prod(s[1..])
  }

vc-helpers: |-
  lemma SumAndProductCorrect(numbers: seq<int>, index: int)
    requires 0 <= index <= |numbers|
    ensures sum(numbers[..index]) == if index == 0 then 0 else sum(numbers[..index-1]) + numbers[index-1]
    ensures prod(numbers[..index]) == if index == 0 then 1 else prod(numbers[..index-1]) * numbers[index-1]
  {
    if index == 0 {
      assert numbers[..0] == [];
      assert sum([]) == 0;
      assert prod([]) == 1;
    } else {
      assert numbers[..index] == numbers[..index-1] + [numbers[index-1]];
      calc {
        sum(numbers[..index]);
        sum(numbers[..index-1] + [numbers[index-1]]);
        sum(numbers[..index-1]) + numbers[index-1];
      }
      calc {
        prod(numbers[..index]);
        prod(numbers[..index-1] + [numbers[index-1]]);
        prod(numbers[..index-1]) * numbers[index-1];
      }
    }
  }

vc-description: |-
  function_signature: def sum_product(numbers: List[int]) -> Tuple[int, int]
  For a given list of integers, return a tuple consisting of a sum and a product of all the integers in a list. Empty sum should be equal to 0 and empty product should be equal to 1.

vc-spec: |-
  method sum_product(numbers: seq<int>) returns (s : int, p : int)
      // post-condition-start
      ensures s == sum(numbers)
      ensures p == prod(numbers)
      // post-condition-end

vc-code: |-
  method sum_product(numbers: seq<int>) returns (s: int, p: int)
  {
    var i := 0;
    s := 0;
    p := 1;
    
    while i < |numbers|
      invariant 0 <= i <= |numbers|
      invariant s == sum(numbers[..i])
      invariant p == prod(numbers[..i])
    {
      SumAndProductCorrect(numbers, i + 1);
      s := s + numbers[i];
      assert s == sum(numbers[..i+1]);
      p := p * numbers[i];
      assert p == prod(numbers[..i+1]);
      i := i + 1;
    }
    
    assert numbers[..i] == numbers;
  }

vc-postamble: |-


