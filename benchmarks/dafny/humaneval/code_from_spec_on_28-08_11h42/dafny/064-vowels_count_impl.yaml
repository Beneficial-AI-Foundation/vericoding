vc-preamble: |-


vc-helpers: |-
  lemma vowel_set_cardinality(s: string, i: int)
    requires 0 <= i <= |s|
    ensures |(set j | 0 <= j < i && is_vowel(s[j]))| <= i
  {
    if i == 0 {
      assert (set j | 0 <= j < i && is_vowel(s[j])) == {};
    } else {
      vowel_set_cardinality(s, i-1);
      var prev_set := (set j | 0 <= j < i-1 && is_vowel(s[j]));
      var curr_set := (set j | 0 <= j < i && is_vowel(s[j]));
      if is_vowel(s[i-1]) {
        assert curr_set == prev_set + {i-1};
        assert |curr_set| == |prev_set| + 1;
      } else {
        assert curr_set == prev_set;
      }
    }
  }
  
  lemma vowel_set_increment(s: string, i: int)
    requires 0 <= i < |s|
    ensures (set j | 0 <= j < i+1 && is_vowel(s[j])) == 
            (set j | 0 <= j < i && is_vowel(s[j])) + (if is_vowel(s[i]) then {i} else {})
  {
  }
  
  lemma vowel_set_cardinality_increment(s: string, i: int)
    requires 0 <= i < |s|
    ensures |(set j | 0 <= j < i+1 && is_vowel(s[j]))| == 
            |(set j | 0 <= j < i && is_vowel(s[j]))| + (if is_vowel(s[i]) then 1 else 0)
  {
    vowel_set_increment(s, i);
  }

vc-description: |-
  function_signature: def remove_vowels(string: str) -> Nat
  Write a function vowels_count which takes a string representing a word as input and returns the number of vowels in the string. Vowels in this case are 'a', 'e', 'i', 'o', 'u'. Here, 'y' is also a vowel, but only when it is at the end of the given word.

vc-spec: |-
  method vowel_count(s: string) returns (count: int)
    // post-conditions-start
    ensures count >= 0
    ensures count == |(set i | 0 <= i < |s| && is_vowel(s[i]))| + if |s| > 0 && s[|s| - 1] == 'y' then 1 else 0
    // post-conditions-end

vc-code: |-
  {
    count := 0;
    var vowel_indices := {};
    
    var i := 0;
    while i < |s|
      invariant 0 <= i <= |s|
      invariant count == |(set j | 0 <= j < i && is_vowel(s[j]))|
      invariant vowel_indices == (set j | 0 <= j < i && is_vowel(s[j]))
    {
      if is_vowel(s[i]) {
        count := count + 1;
        vowel_indices := vowel_indices + {i};
      }
      vowel_set_cardinality_increment(s, i);
      i := i + 1;
    }
    
    if |s| > 0 && s[|s| - 1] == 'y' {
      count := count + 1;
    }
  }

vc-postamble: |-
  function is_vowel(c: char): bool
    ensures is_vowel(c) <==> c == 'a' || c == 'e' || c == 'i' || c == 'o' || c == 'u' || c == 'A' || c == 'E' || c == 'I' || c == 'O' || c == 'U'
  {
      c == 'a' || c == 'e' || c == 'i' || c == 'o' || c == 'u' || c == 'A' || c == 'E' || c == 'I' || c == 'O' || c == 'U'
  }
  // pure-end

