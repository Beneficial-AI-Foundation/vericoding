vc-description: |-
  Given an array of integers, find the minimum number of operations to make it non-decreasing.
  In each operation, select a contiguous non-decreasing subsegment and add 1 to all elements.
  The solution sums violations where arr[i] > arr[i+1], as each violation requires (arr[i] - arr[i+1]) operations.

vc-preamble: |-
  predicate ValidInput(test_cases: seq<seq<int>>)
  {
      forall i :: 0 <= i < |test_cases| ==> |test_cases[i]| >= 1
  }
  
  function SumDifferences(arr: seq<int>, start: int): int
      requires 0 <= start <= |arr|
      decreases |arr| - start
  {
      if start >= |arr| - 1 then 0
      else (if arr[start] > arr[start + 1] then arr[start] - arr[start + 1] else 0) + SumDifferences(arr, start + 1)
  }
  
  predicate CorrectResult(test_cases: seq<seq<int>>, results: seq<int>)
  {
      |results| == |test_cases| &&
      forall i :: 0 <= i < |test_cases| ==> results[i] == SumDifferences(test_cases[i], 0) &&
      forall i :: 0 <= i < |results| ==> results[i] >= 0
  }

vc-helpers: |-
  

vc-spec: |-
  method solve(test_cases: seq<seq<int>>) returns (results: seq<int>)
      requires ValidInput(test_cases)
      ensures CorrectResult(test_cases, results)

vc-code: |-
  {
      results := [];
      var i := 0;
      while i < |test_cases|
          invariant 0 <= i <= |test_cases|
          invariant |results| == i
          invariant forall k :: 0 <= k < i ==> results[k] >= 0
          invariant forall k :: 0 <= k < i ==> results[k] == SumDifferences(test_cases[k], 0)
      {
          var arr := test_cases[i];
          var operations := 0;
          var j := 0;
          while j < |arr| - 1
              invariant 0 <= j <= |arr|
              invariant operations >= 0
              invariant operations == SumDifferences(arr, 0) - SumDifferences(arr, j)
          {
              if arr[j] > arr[j + 1] {
                  operations := operations + (arr[j] - arr[j + 1]);
              }
              j := j + 1;
          }
          results := results + [operations];
          i := i + 1;
      }
  }

vc-postamble: |-
