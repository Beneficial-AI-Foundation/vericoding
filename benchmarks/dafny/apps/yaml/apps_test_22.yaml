vc-description: |-
  Check if a string is an "s-palindrome" - meaning it is symmetric when mirrored horizontally about its center.
  Some letters are symmetric: A, H, I, M, O, o, T, U, V, v, W, w, X, x, Y
  Some letters are mirror pairs: (p,q) and (b,d)
  All other letters cannot form valid s-palindromes

vc-preamble: |-
  predicate is_s_palindrome(s: string)
  {
      var pal := "AHIMOoTUVvWwXxY";
  
      forall i :: 0 <= i < |s| ==> 
          var j := |s| - 1 - i;
          if i >= j then true
          else
              if s[i] == s[j] then s[i] in pal
              else (s[i] == 'p' && s[j] == 'q') || (s[i] == 'q' && s[j] == 'p') ||
                   (s[i] == 'b' && s[j] == 'd') || (s[i] == 'd' && s[j] == 'b')
  }

vc-helpers: |-

vc-spec: |-
  method solve(s: string) returns (result: string)
      requires |s| >= 1
      ensures result == "TAK" || result == "NIE"
      ensures result == "TAK" <==> is_s_palindrome(s)

vc-code: |-
  {
      var pal := "AHIMOoTUVvWwXxY";
      var n := |s|;
      var l := 0;
      var r := n - 1;
      var flag := true;
  
      while l < r && flag
          invariant 0 <= l <= n
          invariant -1 <= r < n
          invariant l <= r + 1
          invariant r == n - 1 - l
          invariant flag ==> (forall i :: 0 <= i < l ==> 
              var j := n - 1 - i;
              i < j ==>
              (if s[i] == s[j] then s[i] in pal
              else (s[i] == 'p' && s[j] == 'q') || (s[i] == 'q' && s[j] == 'p') ||
                   (s[i] == 'b' && s[j] == 'd') || (s[i] == 'd' && s[j] == 'b')))
          invariant !flag ==> !is_s_palindrome(s)
          decreases if flag then r - l + 1 else 0
      {
          if s[l] == s[r] && s[l] in pal {
              l := l + 1;
              r := r - 1;
          } else if s[l] == s[r] {
              flag := false;
          } else if (s[l] == 'p' && s[r] == 'q') || (s[l] == 'q' && s[r] == 'p') {
              l := l + 1;
              r := r - 1;
          } else if (s[l] == 'b' && s[r] == 'd') || (s[l] == 'd' && s[r] == 'b') {
              l := l + 1;
              r := r - 1;
          } else {
              flag := false;
          }
      }
  
      if flag {
          result := "TAK";
      } else {
          result := "NIE";
      }
  }

vc-postamble: |-

