vc-description: |-
  Calculate how many candies will be saved in the year 2016 based on a savings plan.
  Input format: "x of week" (x=1-7, Monday-Sunday) or "x of month" (x=1-31).
  Save one candy on the specified day each week/month.
  2016 is a leap year starting on Friday, week starts on Monday.

vc-preamble: |-
  predicate ValidInput(input: string)
  {
      |input| > 0 &&
      var trimmed := if |input| > 0 && input[|input|-1] == '\n' then input[..|input|-1] else input;
      var parts := SplitOnSpace(trimmed);
      |parts| >= 1
  }
  
  function GetExpectedResult(input: string): string
      requires ValidInput(input)
  {
      var trimmed := if |input| > 0 && input[|input|-1] == '\n' then input[..|input|-1] else input;
      var parts := SplitOnSpace(trimmed);
      if parts[|parts|-1] == "month" then
          if parts[0] == "31" then "7\n"
          else if parts[0] == "30" then "11\n"
          else "12\n"
      else
          if parts[0] == "5" || parts[0] == "6" then "53\n"
          else "52\n"
  }

vc-helpers: |-
  function SplitOnSpace(s: string): seq<string>
      ensures |SplitOnSpace(s)| >= 1
  {
      if |s| == 0 then [""]
      else 
          var parts := SplitOnSpaceHelper(s, 0, "");
          if |parts| == 0 then [""] else parts
  }
  
  function SplitOnSpaceHelper(s: string, index: nat, current: string): seq<string>
      requires index <= |s|
      decreases |s| - index
  {
      if index == |s| then
          if |current| > 0 then [current] else []
      else if s[index] == ' ' then
          if |current| > 0 then [current] + SplitOnSpaceHelper(s, index + 1, "")
          else SplitOnSpaceHelper(s, index + 1, "")
      else
          SplitOnSpaceHelper(s, index + 1, current + [s[index]])
  }

vc-spec: |-
  method solve(input: string) returns (result: string)
      requires ValidInput(input)
      ensures result == GetExpectedResult(input)

vc-code: |-
  {
      var trimmed := if |input| > 0 && input[|input|-1] == '\n' then input[..|input|-1] else input;
      var parts := SplitOnSpace(trimmed);
      if |parts| >= 1 && parts[|parts|-1] == "month" {
          if parts[0] == "31" {
              result := "7\n";
          } else if parts[0] == "30" {
              result := "11\n";
          } else {
              result := "12\n";
          }
      } else {
          if parts[0] == "5" || parts[0] == "6" {
              result := "53\n";
          } else {
              result := "52\n";
          }
      }
  }

vc-postamble: |-

