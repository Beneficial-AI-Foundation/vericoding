vc-description: |-
  This verification task involves finding the minimum number of elements that must be changed to make an array palindromic. A palindromic array reads the same forwards and backwards. The solution should count the number of mismatched pairs between corresponding positions from the start and end of the array.

vc-preamble: |-
  // ======= TASK =======
  // Given an array of integers, find the minimum number of elements that must be changed 
  // to make the array palindromic (reads the same forwards and backwards). You can change 
  // any element to any other integer value.
  
  // ======= SPEC REQUIREMENTS =======
  function count_mismatched_pairs(arr: seq<int>): int
  {
      count_mismatched_pairs_up_to(arr, |arr| / 2)
  }
  
  function count_mismatched_pairs_up_to(arr: seq<int>, limit: int): int
      requires 0 <= limit <= |arr| / 2
  {
      if limit == 0 then 0
      else 
          (if arr[limit-1] != arr[|arr| - limit] then 1 else 0) + 
          count_mismatched_pairs_up_to(arr, limit - 1)
  }
  
  predicate can_make_palindromic_with_changes(arr: seq<int>, num_changes: int)
  {
      num_changes >= 0 && num_changes >= count_mismatched_pairs(arr)
  }

vc-helpers: |-
  // ======= HELPERS =======

vc-spec: |-
  // ======= MAIN METHOD =======
  method smallest_change(arr: seq<int>) returns (changes: int)
      ensures changes >= 0
      ensures changes <= |arr| / 2
      ensures changes == count_mismatched_pairs(arr)
      ensures (|arr| <= 1) ==> (changes == 0)
      ensures forall c :: 0 <= c < changes ==> !can_make_palindromic_with_changes(arr, c)
      ensures can_make_palindromic_with_changes(arr, changes)

vc-code: |-
  {
      var n := |arr|;
      changes := 0;
  
      var i := 0;
      while i < n / 2
          invariant 0 <= i <= n / 2
          invariant changes >= 0
          invariant changes <= i
          invariant changes == count_mismatched_pairs_up_to(arr, i)
      {
          if arr[i] != arr[n - 1 - i] {
              changes := changes + 1;
          }
          i := i + 1;
      }
  }

vc-postamble: |-

