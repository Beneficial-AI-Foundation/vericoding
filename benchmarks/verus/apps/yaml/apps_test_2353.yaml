vc-description: |-
  Given four integers representing sleep requirements and alarm timing,
  simulate an alarm system where: first alarm rings after b minutes,
  if total sleep >= a then wake permanently, otherwise set alarm for c minutes later
  and spend d minutes falling asleep. If alarm rings while falling asleep (c <= d),
  reset and repeat. Find total time until permanent wake or -1 if never happens.

vc-preamble: |-
  use vstd::prelude::*;

  verus! {
  spec fn valid_input(a: int, b: int, c: int, d: int) -> bool {
      a >= 0 && b >= 0 && c >= 0 && d >= 0
  }

  spec fn first_alarm_sufficient(a: int, b: int) -> bool {
      a <= b
  }

  spec fn never_wakes(a: int, b: int, c: int, d: int) -> bool {
      a > b && c <= d
  }

  spec fn eventually_wakes(a: int, b: int, c: int, d: int) -> bool {
      a > b && c > d
  }

  spec fn calculate_wake_time(a: int, b: int, c: int, d: int) -> int {
      let remaining = a - b;
      let cycles = (remaining - 1) / (c - d) + 1;
      b + c * cycles
  }

vc-helpers: |

vc-spec: |-
  fn solve(a: i8, b: i8, c: i8, d: i8) -> (result: i8)
      requires 
          valid_input(a as int, b as int, c as int, d as int)
      ensures 
          first_alarm_sufficient(a as int, b as int) ==> result as int == b as int,
          never_wakes(a as int, b as int, c as int, d as int) ==> result == -1,
          eventually_wakes(a as int, b as int, c as int, d as int) ==> result as int == calculate_wake_time(a as int, b as int, c as int, d as int)

vc-code: |-
  {
      assume(false);
      unreached()
  }

vc-postamble: |2-

  }

  fn main() {}