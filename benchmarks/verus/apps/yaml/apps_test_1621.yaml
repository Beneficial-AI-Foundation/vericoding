vc-description: |-
  Given a string of lowercase letters and a value for each letter, calculate the maximum 
  possible value of a string after inserting exactly k lowercase letters. The value of a 
  string s = s₁s₂...sₙ is defined as f(s) = Σᵢ₌₁ⁿ (wₛᵢ × i), where wₛᵢ is the value of 
  character sᵢ and i is its 1-indexed position.

vc-preamble: |-
  use vstd::prelude::*;

  verus! {

  spec fn string_value(s: Seq<char>, w: Seq<int>) -> int
    requires w.len() == 26,
             forall|i: int| 0 <= i < s.len() ==> 'a' <= s[i] && s[i] <= 'z'
    decreases s.len()
  {
    if s.len() == 0 {
      0
    } else {
      let char_index = (s[s.len() - 1] as int) - ('a' as int);
      string_value(s.subrange(0, (s.len() - 1) as int), w) + s.len() * w[char_index]
    }
  }
  
  spec fn append_value(start_pos: int, count: int, max_val: int) -> int
    requires start_pos >= 0,
             count >= 0
    decreases count
  {
    if count == 0 {
      0
    } else {
      (start_pos + count) * max_val + append_value(start_pos, count - 1, max_val)
    }
  }
  
  spec fn max_value(w: Seq<int>) -> int
    requires w.len() > 0
    ensures exists|i: int| 0 <= i < w.len() && max_value(w) == w[i],
            forall|i: int| 0 <= i < w.len() ==> w[i] <= max_value(w)
    decreases w.len()
  {
    if w.len() == 1 {
      w[0]
    } else if w[0] >= max_value(w.subrange(1, w.len() as int)) {
      w[0]
    } else {
      max_value(w.subrange(1, w.len() as int))
    }
  }
  
  spec fn valid_input(s: Seq<char>, k: int, w: Seq<int>) -> bool {
    w.len() == 26 && 
    k >= 0 && 
    s.len() <= 1000 && 
    k <= 1000 && 
    (forall|i: int| 0 <= i < w.len() ==> 0 <= w[i] <= 1000) &&
    (forall|i: int| 0 <= i < s.len() ==> 'a' <= s[i] && s[i] <= 'z')
  }

vc-helpers: |-

vc-spec: |-
  fn solve(s: Seq<char>, k: int, w: Seq<int>) -> (result: int)
    requires valid_input(s, k, w)
    ensures result == string_value(s, w) + append_value(s.len() as int, k, max_value(w))

vc-code: |-
  {
    // impl-start
    assume(false);
    arbitrary()
    // impl-end
  }

vc-postamble: |-

  }

  fn main() {}