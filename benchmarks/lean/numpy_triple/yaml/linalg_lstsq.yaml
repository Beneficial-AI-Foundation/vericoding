vc-description: |-
  /- 
  {
    "name": "numpy.linalg.lstsq",
    "category": "Solving equations and inverting matrices",
    "description": "Return the least-squares solution to a linear matrix equation",
    "url": "https://numpy.org/doc/stable/reference/generated/numpy.linalg.lstsq.html",
    "doc": "Return the least-squares solution to a linear matrix equation.\n\nSolves the equation a @ x = b by minimizing ||b - ax||^2.\n\nParameters:\n- a: Coefficient matrix (M, N)\n- b: Ordinate values (M,) or (M, K)\n- rcond: Cut-off ratio for small singular values\n\nReturns tuple of:\n- x: Least-squares solution\n- residuals: Sums of squared residuals\n- rank: Rank of matrix a\n- s: Singular values of a",
  }
  -/
  
  /-  Return the least-squares solution to a linear matrix equation -/
  
  /-  Specification: lstsq returns the solution that minimizes ||b - a*x||^2 -/

vc-preamble: |-
  import Std.Do.Triple
  import Std.Tactic.Do
  open Std.Do
  
  /-- Helper function to compute dot product of two vectors -/
  def dotProduct {n : Nat} (u v : Vector Float n) : Float := by
    induction n with
    | zero => exact 0
    | succ k ih => 
      exact (u.get ⟨0, Nat.zero_lt_succ k⟩) * (v.get ⟨0, Nat.zero_lt_succ k⟩) + 
            ih (u.tail) (v.tail)
  /-- Matrix-vector multiplication for Vector types -/
  def matVecMul {M N : Nat} (A : Vector (Vector Float N) M) (x : Vector Float N) : Vector Float M :=
    Vector.ofFn fun i => dotProduct (A.get i) x
  /-- Euclidean norm squared of a vector -/
  def normSq {n : Nat} (v : Vector Float n) : Float :=
    dotProduct v v
  /-- Vector subtraction -/
  def vecSub {n : Nat} (a b : Vector Float n) : Vector Float n :=
    Vector.ofFn fun i => a.get i - b.get i

vc-helpers: |-

vc-definitions: |-
  def lstsq {M N : Nat} (a : Vector (Vector Float N) M) (b : Vector Float M) : 
      Id (Vector Float N) :=
    sorry

vc-theorems: |-
  theorem lstsq_spec {M N : Nat} (a : Vector (Vector Float N) M) (b : Vector Float M) 
      (h_dims : M > 0 ∧ N > 0) :
      ⦃⌜M > 0 ∧ N > 0⌝⦄
      lstsq a b
      ⦃⇓x => ⌜∀ y : Vector Float N, 
             normSq (vecSub b (matVecMul a x)) ≤ normSq (vecSub b (matVecMul a y))⌝⦄ := by
    sorry

vc-postamble: |-

