vc-description: |-


vc-preamble: |-
  use vstd::prelude::*;
  
  verus! {

vc-helpers: |-
  spec fn has_divisor(n: int, k: int) -> bool {
      n % k == 0
  }
  
  proof fn divisor_exists_lemma(n: u32, divisor: u32)
      requires
          n >= 2,
          2 <= divisor < n,
          n % divisor == 0,
      ensures
          exists|k: int| 2 <= k < n && has_divisor(n as int, k),
  {
      assert(has_divisor(n as int, divisor as int));
      assert(2 <= divisor as int && (divisor as int) < (n as int));
  }
  
  proof fn no_divisor_lemma(n: u32)
      requires
          n >= 2,
          forall|k: u32| #[trigger] (n % k) != 0 && 2 <= k < n,
      ensures
          !exists|k: int| 2 <= k < n && has_divisor(n as int, k),
  {
      if exists|k: int| 2 <= k < n && has_divisor(n as int, k) {
          let witness_k = choose|k: int| 2 <= k < n && has_divisor(n as int, k);
          assert(2 <= witness_k < n);
          assert(has_divisor(n as int, witness_k));
          assert(n as int % witness_k == 0);
          assert(witness_k >= 0);
          assert(witness_k < u32::MAX as int);
          let k_u32 = witness_k as u32;
          assert(2 <= k_u32 < n);
          assert(n % k_u32 == 0);
          assert(false);
      }
  }

vc-spec: |-
  #[verifier::loop_isolation(false)]
  fn is_non_prime(n: u32) -> (result: bool)
      // pre-conditions-start
      requires
          n >= 2,
      // pre-conditions-end
      // post-conditions-start
      ensures
          result == exists|k: int| 2 <= k < n && #[trigger] (n as int % k) == 0,
      // post-conditions-end

vc-code: |-
  {
      let mut i = 2;
      while i < n
          invariant
              2 <= i <= n,
              forall|k: u32| #[trigger] (n % k) != 0 && 2 <= k < i,
          decreases
              n - i,
      {
          if n % i == 0 {
              proof {
                  divisor_exists_lemma(n, i);
              }
              return true;
          }
          i = i + 1;
      }
      proof {
          no_divisor_lemma(n);
      }
      false
  }

vc-postamble: |-
  
  fn main() {}
  }

