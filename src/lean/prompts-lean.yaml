generate_code: |
  The task is to generate implementations and proofs for "sorry" placeholders in a Lean file.
  
  INPUT: a Lean file containing "sorry" keywords in place of desired implementations and proofs.
  
  OUTPUT: Return a JSON array with one replacement for each "sorry" in the file, in order from top to bottom:
  ```json
  ["first_implementation", "second_proof", "third_implementation"]
  ```
  
  CRITICAL RULES:
  - Provide exactly one replacement for each "sorry" in the file, in the exact order they appear (top to bottom)
  - Each replacement should be the exact code/proof that goes where "sorry" appears
  - IMPORTANT: Your replacement text goes directly where the "sorry" is - if you need helper functions, define them inline within the replacement
  - NEVER use verification bypasses: "sorry", "axiom", "unsafe", "Unchecked.cast", "partial def", or "@[extern]"
  - Use valid Lean syntax for all replacements
  - You may include helper definitions, theorems, and lemmas in replacements when needed
  - For helper definitions added within a replacement, add comment -- LLM HELPER before them
  - Return ONLY a valid JSON array, no explanations or markdown
  
  LEAN FILE WITH SORRY PLACEHOLDERS:
  {code}

fix_verification: |
  The task is to fix implementations and proofs that failed verification by providing replacements for any remaining "sorry" placeholders.
  
  INPUT: a Lean file that contains "sorry" keywords in place of implementations/proofs that need to be fixed based on verification errors.
  
  OUTPUT: Return a JSON array with one fixed replacement for each "sorry" in the file, in order from top to bottom:
  ```json
  ["fixed_implementation", "fixed_proof", "another_fixed_implementation"]
  ```
  
  CRITICAL RULES:
  - Provide exactly one replacement for each "sorry" in the file, in the exact order they appear (top to bottom)
  - Each replacement should be the exact fixed code/proof that goes where "sorry" appears
  - IMPORTANT: Your replacement text goes directly where the "sorry" is - if you need helper functions, define them inline within the replacement
  - NEVER use verification bypasses: "sorry", "axiom", "unsafe", "Unchecked.cast", "partial def", or "@[extern]" 
  - Use valid Lean syntax for all replacements
  - You may include helper definitions, theorems, and lemmas in replacements when needed
  - For helper definitions added within a replacement, add comment -- LLM HELPER before them
  - Return ONLY a valid JSON array, no explanations or markdown
  
  NOTE: If your previous response included verification bypasses like "sorry" or "axiom", that counts as a failure even if lake build succeeded. Provide complete, verified implementations without any cheats.
  
  ERROR DETAILS from Lean verification:
  {errorDetails}

  ORIGINAL FILE (for context):
  {original_code}

  CURRENT ITERATION FILE (with failed implementations to learn from):
  {code}
