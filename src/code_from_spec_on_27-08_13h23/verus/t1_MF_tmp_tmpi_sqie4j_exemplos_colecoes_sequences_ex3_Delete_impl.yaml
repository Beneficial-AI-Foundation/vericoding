vc-preamble: |-
  use vstd::prelude::*;
  
  verus! {
  
  // line contém uma string de tamanho l
  // remover p caracteres a partir da posição at

vc-helpers: |-
  // No updates needed in helpers for this fix

vc-spec: |-
  // <vc-spec>
  fn delete(line: &mut Vec<char>, l: usize, at: usize, p: usize)
      requires
          l <= old(line).len(),
          at + p <= l,
      ensures
          line@ == old(line)@.subrange(0, at as int) + old(line)@.subrange((at + p) as int, l as int),
  // </vc-spec>

vc-code: |-
  fn delete(line: &mut Vec<char>, l: usize, at: usize, p: usize)
      requires
          l <= old(line).len(),
          at + p <= l,
      ensures
          line@ == old(line)@.subrange(0, at as int) + old(line)@.subrange((at + p) as int, l as int),
  {
      let mut i: usize = at;
      let end: usize = at + p;
      let mut j: usize = end;
      
      while j < l
          invariant
              at <= i <= end,
              end <= j <= l,
              line@.subrange(0, at as int) == old(line)@.subrange(0, at as int),
              line@.subrange(at as int, i as int) == old(line)@.subrange(end as int, j as int),
              line@.subrange(i as int, line.len() as int) == old(line)@.subrange(i as int, line.len() as int),
              l == old(line).len(),
          decreases
              l - j,
      {
          line.set(i, line@[j]);
          i = i + 1;
          j = j + 1;
      }
      
      let new_len: usize = l - p;
      line.truncate(new_len);
  }

vc-postamble: |-
  
  fn main() {
  }
  
  }

