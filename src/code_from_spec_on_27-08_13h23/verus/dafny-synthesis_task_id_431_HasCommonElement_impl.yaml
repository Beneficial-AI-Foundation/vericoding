vc-preamble: |-
  use vstd::prelude::*;
  
  verus! {

vc-helpers: |-
  proof fn lemma_common_element_found(a: Seq<i32>, b: Seq<i32>, i: int, j: int)
      requires
          0 <= i < a.len(),
          0 <= j < b.len(),
          a[i] == b[j],
      ensures
          exists|i: int, j: int| 0 <= i < a.len() && 0 <= j < b.len() && a[i] == b[j],
  {
  }
  
  proof fn lemma_no_common_element(a: Seq<i32>, b: Seq<i32>)
      requires
          forall|i: int, j: int| 0 <= i < a.len() && 0 <= j < b.len() ==> a[i] != b[j],
      ensures
          !exists|i: int, j: int| 0 <= i < a.len() && 0 <= j < b.len() && a[i] == b[j],
  {
  }

vc-spec: |-
  // <vc-spec>
  fn has_common_element(a: &[i32], b: &[i32]) -> (result: bool)
      ensures 
          result ==> (exists|i: int, j: int| 0 <= i < a.len() && 0 <= j < b.len() && a[i] == b[j]) &&
          (!result ==> (forall|i: int, j: int| 0 <= i < a.len() && 0 <= j < b.len() ==> a[i] != b[j]))
  // </vc-spec>

vc-code: |-
  fn has_common_element(a: &[i32], b: &[i32]) -> (result: bool)
      ensures
          result ==> (exists|i: int, j: int| 0 <= i < a.len() && 0 <= j < b.len() && a[i] == b[j]),
          !result ==> (forall|i: int, j: int| 0 <= i < a.len() && 0 <= j < b.len() ==> a[i] != b[j]),
  {
      let mut i: usize = 0;
      while i < a.len()
          invariant
              0 <= i <= a.len(),
              forall|k: int| 0 <= k < i as int ==> forall|m: int| 0 <= m < b.len() ==> a[k] != b[m],
      {
          let mut j: usize = 0;
          while j < b.len()
              invariant
                  0 <= i < a.len(),
                  0 <= j <= b.len(),
                  forall|k: int| 0 <= k < i as int ==> forall|m: int| 0 <= m < b.len() ==> a[k] != b[m],
                  forall|m: int| 0 <= m < j as int ==> a[i] != b[m],
          {
              if a[i] == b[j] {
                  proof {
                      lemma_common_element_found(a@, b@, i as int, j as int);
                  }
                  return true;
              }
              j = j + 1;
          }
          i = i + 1;
      }
      proof {
          lemma_no_common_element(a@, b@);
      }
      false
  }

vc-postamble: |-
  
  fn main() {}
  
  }

