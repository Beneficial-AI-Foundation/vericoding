vc-preamble: |-
  // definition of Fibonacci numbers
  function Fibonacci(n: nat): nat {
    match n {
      case 0 => 0
      case 1 => 1
      case _ => Fibonacci(n - 1) + Fibonacci(n - 2)
    }
  }
  
  // iterative calculation of Fibonacci numbers

vc-helpers: |-
  lemma FibonacciIterativeCorrect(n: nat, a: nat, b: nat, i: nat)
    requires i <= n
    requires a == Fibonacci(i)
    requires b == Fibonacci(i + 1)
    ensures b == Fibonacci(i + 1)
    ensures i == n ==> b == Fibonacci(n + 1)
    decreases n - i
  {
    if i == n {
      assert b == Fibonacci(i + 1);
      assert b == Fibonacci(n + 1);
    }
  }

vc-spec: |-
  // <vc-spec>
  method FibonacciIterative(n: nat) returns (f: nat)
    ensures f == Fibonacci(n)
  // </vc-spec>

vc-code: |-
  method ComputeFibonacci(n: nat) returns (f: nat)
    ensures f == Fibonacci(n)
  {
    if n == 0 {
      return 0;
    } else if n == 1 {
      return 1;
    }
    
    var a: nat := 0; // Fibonacci(0)
    var b: nat := 1; // Fibonacci(1)
    var i: nat := 1;
    
    while i < n
      invariant 0 <= i <= n
      invariant a == Fibonacci(i - 1)
      invariant b == Fibonacci(i)
    {
      var temp: nat := b;
      b := a + b;
      a := temp;
      i := i + 1;
    }
    
    f := b;
    return f;
  }

vc-postamble: |-


